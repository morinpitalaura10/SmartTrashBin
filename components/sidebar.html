<aside class="sidebar" aria-label="Sidebar utama">
  <div class="logo" aria-label="Logo Smart Trash Bin">
    <!-- pastikan file ada di assets/logo.png -->
    <img src="assets/logo.png" alt="Smart Trash Bin" class="site-logo" />
  </div>

  <ul class="menu" role="menu">
    <li role="none">
      <a href="index.html" id="link-dashboard" role="menuitem" data-link
        ><i class="fa-solid fa-table-columns" aria-hidden="true"></i>
        <span>Dashboard</span></a
      >
    </li>

    <li role="none">
      <a href="riwayat.html" id="link-riwayat" role="menuitem" data-link
        ><i class="fa-solid fa-clock-rotate-left" aria-hidden="true"></i>
        <span>Riwayat</span></a
      >
    </li>

    <li role="none">
      <a href="grafik.html" id="link-grafik" role="menuitem" data-link
        ><i class="fa-solid fa-chart-column" aria-hidden="true"></i>
        <span>Grafik</span></a
      >
    </li>

    <li class="mode-toggle" role="none">
      <label for="toggle-theme" aria-label="Toggle Dark Mode">
        <input type="checkbox" id="toggle-theme" />
        <i class="fa-solid fa-moon" aria-hidden="true"></i>
        <span>Dark Mode</span>
      </label>
    </li>

    <li class="logout-btn-wrap" role="none">
      <button class="logout-btn" type="button" id="btn-logout">
        <i class="fa-solid fa-right-from-bracket" aria-hidden="true"></i>
        <span>Logout</span>
      </button>
    </li>
  </ul>
</aside>

<script>
  // ----- Helper: ambil nama file halaman (index.html default)
  function currentPageName() {
    const name = (location.pathname.split("/").pop() || "index.html").toLowerCase();
    // handle root path tanpa file ("/")
    return name === "" ? "index.html" : name;
  }

  // ----- Tandai link aktif + aria-current
  function markActiveLink() {
    const page = currentPageName();
    const map = {
      "index.html": "link-dashboard",
      "riwayat.html": "link-riwayat",
      "grafik.html": "link-grafik",
    };

    document.querySelectorAll(".menu a[data-link]").forEach((a) => {
      a.classList.remove("active");
      a.removeAttribute("aria-current");
    });

    const activeId = map[page] || "link-dashboard";
    const el = document.getElementById(activeId);
    if (el) {
      el.classList.add("active");
      el.setAttribute("aria-current", "page");
    }
  }

  // ----- Sync & toggle tema
  function initThemeToggle() {
    const toggle = document.getElementById("toggle-theme");
    const saved = localStorage.getItem("stb-theme");
    if (saved === "dark") {
      document.body.classList.add("dark-mode");
      if (toggle) toggle.checked = true;
    }
    toggle?.addEventListener("change", () => {
      const dark = toggle.checked;
      document.body.classList.toggle("dark-mode", dark);
      localStorage.setItem("stb-theme", dark ? "dark" : "light");
    });
  }

  // ----- Logout
  function initLogout() {
    const btn = document.getElementById("btn-logout");
    btn?.addEventListener("click", () => {
      if (confirm("Yakin ingin keluar dari akun ini?")) {
        // hapus auth sederhana
        localStorage.removeItem("stb-auth");
        // opsional: bersihkan tema bila ingin reset
        // localStorage.removeItem("stb-theme");
        location.href = "login.html";
      }
    });
  }

  // Jalankan setelah fragmen di-include (via include.js)
  // Jika tidak pakai include, ini tetap dipanggil karena DOMContentLoaded sudah terjadi.
  const runSetup = () => {
    markActiveLink();
    initThemeToggle();
    initLogout();
  };

  // support event dari include.js
  document.addEventListener("componentsLoaded", runSetup);
  // fallback kalau file dimuat langsung (tanpa include)
  if (document.readyState === "complete" || document.readyState === "interactive") {
    // delay microtask agar elemen terpasang penuh
    Promise.resolve().then(runSetup);
  } else {
    document.addEventListener("DOMContentLoaded", runSetup);
  }
</script>
